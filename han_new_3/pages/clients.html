<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–ª–∏–µ–Ω—Ç—ã - HAN CRM</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/clients.css">
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
        <div class="nav-brand">
            <h1>üåª HAN CRM</h1>
        </div>
        <div class="nav-menu">
            <a href="dashboard.html">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="sales.html">–ü—Ä–æ–¥–∞–∂–∏</a>
            <a href="clients.html" class="active">–ö–ª–∏–µ–Ω—Ç—ã</a>
            <a href="products.html">–¢–æ–≤–∞—Ä—ã</a>
            <a href="production.html" data-role="manager,admin">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</a>
            <a href="writeoffs.html" data-role="manager,admin">–°–ø–∏—Å–∞–Ω–∏—è</a>
            <a href="stock.html" data-role="manager,admin">–°–∫–ª–∞–¥</a>
            <a href="reports.html" data-role="manager,admin">–û—Ç—á—ë—Ç—ã</a>
        </div>
        <div class="nav-user">
            <span id="userName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
            <button onclick="logout()" class="btn-logout">–í—ã—Ö–æ–¥</button>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –¥–µ–π—Å—Ç–≤–∏—è -->
        <div class="page-header">
            <div>
                <h2>–ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤</h2>
                <p class="page-subtitle">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑–æ–π</p>
            </div>
            <div class="page-actions">
                <button class="btn btn-secondary" onclick="clientsPage.exportToExcel()">
                    üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
                </button>
                <button class="btn btn-primary" onclick="clientsPage.openCreateModal()" data-role="manager,admin">
                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
                </button>
            </div>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
        <div class="filters-bar">
            <div class="search-box">
                <input 
                    type="text" 
                    id="searchInput" 
                    class="search-input" 
                    placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—É..."
                >
            </div>
            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">
                    –í—Å–µ (<span id="countAll">0</span>)
                </button>
                <button class="filter-tab" data-filter="debtors">
                    –î–æ–ª–∂–Ω–∏–∫–∏ (<span id="countDebtors">0</span>)
                </button>
                <button class="filter-tab" data-filter="overpayments">
                    –° –ø–µ—Ä–µ–ø–ª–∞—Ç–æ–π (<span id="countOverpayments">0</span>)
                </button>
            </div>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
        <div class="card">
            <div class="table-container">
                <table class="data-table" id="clientsTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ò–º—è</th>
                            <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                            <th>–ê–¥—Ä–µ—Å</th>
                            <th>–î–æ–ª–≥</th>
                            <th>–ü–µ—Ä–µ–ø–ª–∞—Ç–∞</th>
                            <th>–ü—Ä–æ–¥–∞–∂–∏</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="clientsTableBody">
                        <tr>
                            <td colspan="9" class="text-center">
                                <div class="loader"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
            <div class="pagination" id="pagination"></div>
        </div>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –°–æ–∑–¥–∞–Ω–∏–µ/–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</h3>
                <button class="modal-close" onclick="clientsPage.closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="clientForm">
                    <input type="hidden" id="clientId">
                    
                    <div class="form-group">
                        <label for="clientName">–ù–∞–∑–≤–∞–Ω–∏–µ / –§–ò–û <span class="required">*</span></label>
                        <input 
                            type="text" 
                            id="clientName" 
                            class="form-control" 
                            placeholder="–¢–û–û '–†–æ–≥–∞ –∏ –ö–æ–ø—ã—Ç–∞' –∏–ª–∏ –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="clientPhone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                        <input 
                            type="text" 
                            id="clientPhone" 
                            class="form-control" 
                            placeholder="+996 555 123 456"
                        >
                    </div>

                    <div class="form-group">
                        <label for="clientAddress">–ê–¥—Ä–µ—Å</label>
                        <textarea 
                            id="clientAddress" 
                            class="form-control" 
                            rows="2" 
                            placeholder="–≥. –ë–∏—à–∫–µ–∫, —É–ª. –õ–µ–Ω–∏–Ω–∞ 1"
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="clientIsActive" checked>
                            <span>–ê–∫—Ç–∏–≤–µ–Ω</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="clientsPage.closeModal()">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button class="btn btn-primary" onclick="clientsPage.saveClient()">
                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –î–µ—Ç–∞–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞ -->
    <div id="clientDetailsModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="clientDetailsTitle">–î–µ—Ç–∞–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞</h3>
                <button class="modal-close" onclick="clientsPage.closeDetailsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="clientDetailsContent">
                    <div class="loader"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="clientsPage.closeDetailsModal()">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ: –í—ã–¥–∞—á–∞ –ø–µ—Ä–µ–ø–ª–∞—Ç—ã -->
    <div id="withdrawModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–í—ã–¥–∞—Ç—å –ø–µ—Ä–µ–ø–ª–∞—Ç—É</h3>
                <button class="modal-close" onclick="clientsPage.closeWithdrawModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="withdrawClientInfo" class="info-box"></div>
                
                <form id="withdrawForm">
                    <input type="hidden" id="withdrawClientId">
                    
                    <div class="form-group">
                        <label for="withdrawAmount">–°—É–º–º–∞ <span class="required">*</span></label>
                        <input 
                            type="number" 
                            id="withdrawAmount" 
                            class="form-control" 
                            step="0.01"
                            min="0.01"
                            placeholder="0.00"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="withdrawNote">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</label>
                        <textarea 
                            id="withdrawNote" 
                            class="form-control" 
                            rows="2" 
                            placeholder="–í—ã–¥–∞–Ω–æ –Ω–∞–ª–∏—á–Ω—ã–º–∏ –ø–æ –ø—Ä–æ—Å—å–±–µ –∫–ª–∏–µ–Ω—Ç–∞"
                        ></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="clientsPage.closeWithdrawModal()">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <button class="btn btn-danger" onclick="clientsPage.confirmWithdraw()">
                    –í—ã–¥–∞—Ç—å
                </button>
            </div>
        </div>
    </div>

    <!-- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script type="module" src="../js/pages/clients.js"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞
        function logout() {
            if (confirm('–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã?')) {
                localStorage.removeItem('auth_token');
                localStorage.removeItem('user');
                window.location.href = '../login.html';
            }
        }
    </script>
</body>
</html>