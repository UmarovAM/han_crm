<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç—á—ë—Ç—ã - HAN CRM</title>
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/components.css">
    <link rel="stylesheet" href="../assets/css/reports.css">
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
        <div class="nav-brand">
            <h1>üåª HAN CRM</h1>
        </div>
        <div class="nav-menu">
            <a href="dashboard.html">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="sales.html">–ü—Ä–æ–¥–∞–∂–∏</a>
            <a href="clients.html">–ö–ª–∏–µ–Ω—Ç—ã</a>
            <a href="products.html">–¢–æ–≤–∞—Ä—ã</a>
            <a href="production.html" data-role="manager,admin">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</a>
            <a href="writeoffs.html" data-role="manager,admin">–°–ø–∏—Å–∞–Ω–∏—è</a>
            <a href="stock.html" data-role="manager,admin">–°–∫–ª–∞–¥</a>
            <a href="reports.html" class="active" data-role="manager,admin">–û—Ç—á—ë—Ç—ã</a>
        </div>
        <div class="nav-user">
            <span id="userName">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
            <button onclick="logout()" class="btn-logout">–í—ã—Ö–æ–¥</button>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="container">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="page-header">
            <div>
                <h2>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á—ë—Ç—ã</h2>
                <p class="page-subtitle">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –±–∏–∑–Ω–µ—Å–∞</p>
            </div>
            <div class="page-actions">
                <button class="btn btn-secondary" onclick="reportsPage.printReport()">
                    üñ®Ô∏è –ü–µ—á–∞—Ç—å
                </button>
                <button class="btn btn-primary" onclick="reportsPage.exportToExcel()">
                    üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
                </button>
            </div>
        </div>

        <!-- –ü–µ—Ä–∏–æ–¥ -->
        <div class="period-selector">
            <div class="period-buttons">
                <button class="period-btn active" data-period="today" onclick="reportsPage.selectPeriod('today')">
                    –°–µ–≥–æ–¥–Ω—è
                </button>
                <button class="period-btn" data-period="week" onclick="reportsPage.selectPeriod('week')">
                    –ù–µ–¥–µ–ª—è
                </button>
                <button class="period-btn" data-period="month" onclick="reportsPage.selectPeriod('month')">
                    –ú–µ—Å—è—Ü
                </button>
                <button class="period-btn" data-period="custom" onclick="reportsPage.selectPeriod('custom')">
                    –°–≤–æ–π –ø–µ—Ä–∏–æ–¥
                </button>
            </div>
            <div class="period-dates" id="customPeriod" style="display: none;">
                <input type="date" id="dateFrom" class="form-control">
                <span>‚Äî</span>
                <input type="date" id="dateTo" class="form-control">
                <button class="btn btn-secondary" onclick="reportsPage.applyCustomPeriod()">
                    –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                </button>
            </div>
            <div class="period-display">
                –ü–µ—Ä–∏–æ–¥: <strong id="periodDisplay">–°–µ–≥–æ–¥–Ω—è</strong>
            </div>
        </div>

        <!-- –°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="summary-section">
            <h3>–°–≤–æ–¥–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <div class="stats-grid">
                <div class="stat-box sales">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-content">
                        <div class="stat-label">–ü—Ä–æ–¥–∞–∂–∏</div>
                        <div class="stat-value" id="statSalesAmount">0 —Å–æ–º</div>
                        <div class="stat-detail" id="statSalesCount">0 —á–µ–∫–æ–≤</div>
                    </div>
                </div>
                <div class="stat-box payments">
                    <div class="stat-icon">üí≥</div>
                    <div class="stat-content">
                        <div class="stat-label">–ü–ª–∞—Ç–µ–∂–∏</div>
                        <div class="stat-value" id="statPaymentsAmount">0 —Å–æ–º</div>
                        <div class="stat-detail" id="statPaymentsCount">0 –ø–ª–∞—Ç–µ–∂–µ–π</div>
                    </div>
                </div>
                <div class="stat-box debt">
                    <div class="stat-icon">üìä</div>
                    <div class="stat-content">
                        <div class="stat-label">–î–æ–ª–≥–∏</div>
                        <div class="stat-value" id="statDebtAmount">0 —Å–æ–º</div>
                        <div class="stat-detail" id="statDebtCount">0 –¥–æ–ª–∂–Ω–∏–∫–æ–≤</div>
                    </div>
                </div>
                <div class="stat-box overpayment">
                    <div class="stat-icon">üíµ</div>
                    <div class="stat-content">
                        <div class="stat-label">–ü–µ—Ä–µ–ø–ª–∞—Ç—ã</div>
                        <div class="stat-value" id="statOverpaymentAmount">0 —Å–æ–º</div>
                        <div class="stat-detail" id="statOverpaymentCount">0 –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ –æ—Ç—á—ë—Ç–æ–≤ -->
        <div class="reports-tabs">
            <button class="report-tab active" data-tab="sales" onclick="reportsPage.switchTab('sales')">
                üìà –ü—Ä–æ–¥–∞–∂–∏
            </button>
            <button class="report-tab" data-tab="clients" onclick="reportsPage.switchTab('clients')">
                üë• –ö–ª–∏–µ–Ω—Ç—ã
            </button>
            <button class="report-tab" data-tab="products" onclick="reportsPage.switchTab('products')">
                üì¶ –¢–æ–≤–∞—Ä—ã
            </button>
            <button class="report-tab" data-tab="stock" onclick="reportsPage.switchTab('stock')">
                üè™ –°–∫–ª–∞–¥
            </button>
        </div>

        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –≤–∫–ª–∞–¥–æ–∫ -->
        <div class="tabs-content">
            <!-- –û—Ç—á—ë—Ç –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º -->
            <div class="tab-pane active" id="tabSales">
                <div class="report-section">
                    <h4>–î–∏–Ω–∞–º–∏–∫–∞ –ø—Ä–æ–¥–∞–∂</h4>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>–î–∞—Ç–∞</th>
                                    <th>–ü—Ä–æ–¥–∞–∂</th>
                                    <th>–°—É–º–º–∞</th>
                                    <th>–û–ø–ª–∞—á–µ–Ω–æ</th>
                                    <th>–î–æ–ª–≥</th>
                                    <th>–°—Ä–µ–¥–Ω–∏–π —á–µ–∫</th>
                                </tr>
                            </thead>
                            <tbody id="salesByDayBody">
                                <tr><td colspan="6" class="text-center"><div class="loader"></div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="report-section">
                    <h4>–¢–æ–ø —Ç–æ–≤–∞—Ä—ã</h4>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>‚Ññ</th>
                                    <th>–¢–æ–≤–∞—Ä</th>
                                    <th>–ü—Ä–æ–¥–∞–Ω–æ (—à—Ç)</th>
                                    <th>–°—É–º–º–∞</th>
                                    <th>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞</th>
                                </tr>
                            </thead>
                            <tbody id="topProductsBody">
                                <tr><td colspan="5" class="text-center"><div class="loader"></div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –û—Ç—á—ë—Ç –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º -->
            <div class="tab-pane" id="tabClients">
                <div class="report-section">
                    <h4>–¢–æ–ø –∫–ª–∏–µ–Ω—Ç—ã</h4>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>‚Ññ</th>
                                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                                    <th>–ü—Ä–æ–¥–∞–∂</th>
                                    <th>–°—É–º–º–∞</th>
                                    <th>–û–ø–ª–∞—á–µ–Ω–æ</th>
                                    <th>–î–æ–ª–≥</th>
                                </tr>
                            </thead>
                            <tbody id="topClientsBody">
                                <tr><td colspan="6" class="text-center"><div class="loader"></div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="report-section">
                    <h4>–î–æ–ª–∂–Ω–∏–∫–∏</h4>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>–ö–ª–∏–µ–Ω—Ç</th>
                                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                    <th>–ü—Ä–æ–¥–∞–∂</th>
                                    <th>–°—É–º–º–∞ –¥–æ–ª–≥–∞</th>
                                </tr>
                            </thead>
                            <tbody id="debtorsBody">
                                <tr><td colspan="4" class="text-center"><div class="loader"></div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –û—Ç—á—ë—Ç –ø–æ —Ç–æ–≤–∞—Ä–∞–º -->
            <div class="tab-pane" id="tabProducts">
                <div class="report-section">
                    <h4>–ü—Ä–æ–¥–∞–∂–∏ –ø–æ —Ç–æ–≤–∞—Ä–∞–º</h4>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>–¢–æ–≤–∞—Ä</th>
                                    <th>–ü—Ä–æ–¥–∞–Ω–æ (—à—Ç)</th>
                                    <th>–°—É–º–º–∞</th>
                                    <th>–°—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞</th>
                                    <th>–ü—Ä–æ–¥–∞–∂</th>
                                </tr>
                            </thead>
                            <tbody id="productsSalesBody">
                                <tr><td colspan="5" class="text-center"><div class="loader"></div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –û—Ç—á—ë—Ç –ø–æ —Å–∫–ª–∞–¥—É -->
            <div class="tab-pane" id="tabStock">
                <div class="report-section">
                    <h4>–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∫–ª–∞–¥–∞</h4>
                    <div class="stock-summary">
                        <div class="stock-item">
                            <div class="stock-label">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤:</div>
                            <div class="stock-value" id="stockTotal">0</div>
                        </div>
                        <div class="stock-item">
                            <div class="stock-label">–í –Ω–∞–ª–∏—á–∏–∏:</div>
                            <div class="stock-value" id="stockInStock">0</div>
                        </div>
                        <div class="stock-item">
                            <div class="stock-label">–ú–∞–ª–æ –Ω–∞ —Å–∫–ª–∞–¥–µ:</div>
                            <div class="stock-value warning" id="stockLowStock">0</div>
                        </div>
                        <div class="stock-item">
                            <div class="stock-label">–ó–∞–∫–æ–Ω—á–∏–ª–∏—Å—å:</div>
                            <div class="stock-value danger" id="stockOutOfStock">0</div>
                        </div>
                    </div>
                </div>

                <div class="report-section">
                    <h4>–¢–æ–≤–∞—Ä—ã —Ç—Ä–µ–±—É—é—â–∏–µ –≤–Ω–∏–º–∞–Ω–∏—è</h4>
                    <div class="table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>–¢–æ–≤–∞—Ä</th>
                                    <th>–û—Å—Ç–∞—Ç–æ–∫</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–¶–µ–Ω–∞</th>
                                </tr>
                            </thead>
                            <tbody id="lowStockBody">
                                <tr><td colspan="4" class="text-center"><div class="loader"></div></td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script type="module" src="../js/pages/reports.js"></script>
    <script>
        function logout() {
            if (confirm('–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã?')) {
                localStorage.removeItem('auth_token');
                localStorage.removeItem('user');
                window.location.href = '../login.html';
            }
        }
    </script>
</body>
</html>