# üèóÔ∏è **–ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê HAN CRM v3.1 FINAL**

## üìÅ **–°–¢–†–£–ö–¢–£–†–ê BACKEND**

```
api/
‚îú‚îÄ‚îÄ classes/
‚îÇ   ‚îú‚îÄ‚îÄ Database.php              ‚úÖ –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ Auth.php                  ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (—Å–µ—Å—Å–∏–∏)
‚îÇ   ‚îú‚îÄ‚îÄ Response.php              ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ Middleware.php            ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤, –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ OverpaymentService.php    üî• –ü–µ—Ä–µ–ø–ª–∞—Ç—ã (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –±–µ–∑ 'used')
‚îÇ   ‚îú‚îÄ‚îÄ PaymentService.php        üÜï –ù–û–í–´–ô! –ü–ª–∞—Ç–µ–∂–∏ (–≤—ã–¥–µ–ª–µ–Ω)
‚îÇ   ‚îú‚îÄ‚îÄ SalesService.php          üîß –£–ø—Ä–æ—â—ë–Ω (—É–±—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π)
‚îÇ   ‚îú‚îÄ‚îÄ StockService.php          ‚úÖ –°–∫–ª–∞–¥
‚îÇ   ‚îú‚îÄ‚îÄ ClientService.php         ‚ö†Ô∏è –°–û–ó–î–ê–¢–¨
‚îÇ   ‚îú‚îÄ‚îÄ ProductService.php        ‚ö†Ô∏è –°–û–ó–î–ê–¢–¨
‚îÇ   ‚îî‚îÄ‚îÄ ReceiptService.php        ‚ö†Ô∏è –°–û–ó–î–ê–¢–¨ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–º–µ—Ä–æ–≤)
‚îÇ
‚îú‚îÄ‚îÄ auth.php                      ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ sales.php                     üîß –ò—Å–ø–æ–ª—å–∑—É–µ—Ç SalesService
‚îú‚îÄ‚îÄ payments.php                  üîß –ò—Å–ø–æ–ª—å–∑—É–µ—Ç PaymentService
‚îú‚îÄ‚îÄ clients.php                   ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ClientService
‚îú‚îÄ‚îÄ products.php                  ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç ProductService
‚îî‚îÄ‚îÄ overpayments.php              üÜï –°–û–ó–î–ê–¢–¨ (–æ—Ç–¥–µ–ª—å–Ω—ã–π endpoint)
```

---

## üéØ **–ü–†–ò–ù–¶–ò–ü–´ –ù–û–í–û–ô –ê–†–•–ò–¢–ï–ö–¢–£–†–´**

### 1Ô∏è‚É£ **–û–¥–∏–Ω —Å–µ—Ä–≤–∏—Å = –æ–¥–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**

| –°–µ—Ä–≤–∏—Å | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å |
|--------|----------------|
| `SalesService` | –°–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂ |
| `PaymentService` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞–º–∏ |
| `OverpaymentService` | –ü–µ—Ä–µ–ø–ª–∞—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ |
| `StockService` | –î–≤–∏–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ |
| `ClientService` | CRUD –∫–ª–∏–µ–Ω—Ç–æ–≤ |
| `ProductService` | CRUD —Ç–æ–≤–∞—Ä–æ–≤ |

### 2Ô∏è‚É£ **–ù–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**

```
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:

SalesService ‚Üí StockService
SalesService ‚Üí OverpaymentService
PaymentService ‚Üí OverpaymentService

‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–±—ã–ª–æ —Ä–∞–Ω—å—à–µ):

SalesService ‚Üí OverpaymentService ‚Üí SalesService
```

### 3Ô∏è‚É£ **–ü–µ—Ä–µ–ø–ª–∞—Ç–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –û–î–ò–ù –†–ê–ó**

| –°–æ–±—ã—Ç–∏–µ | –ö—Ç–æ —Å–æ–∑–¥–∞—ë—Ç –ø–µ—Ä–µ–ø–ª–∞—Ç—É |
|---------|----------------------|
| –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏ —Å –ø–µ—Ä–µ–ø–ª–∞—Ç–æ–π | `SalesService::createSale()` |
| –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ (–µ—Å–ª–∏ –ø–µ—Ä–µ–ø–ª–∞—Ç–∞) | `PaymentService::createPayment()` |
| –†—É—á–Ω–æ–µ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ | `OverpaymentService::create()` |

### 4Ô∏è‚É£ **–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö**

```php
$this->db->beginTransaction();
try {
    // ... –æ–ø–µ—Ä–∞—Ü–∏–∏
    $this->db->commit();
} catch (Exception $e) {
    $this->db->rollback();
    throw $e;
}
```

---

## üîÑ **–û–ë–ù–û–í–õ–Å–ù–ù–´–ï –ü–û–¢–û–ö–ò –î–ê–ù–ù–´–•**

### **–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏:**

```
1. SalesService::createSale()
   ‚Üì
2. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤
   ‚Üì
3. StockService::decreaseStock() –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
   ‚Üì
4. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ sale
   ‚Üì
5. –°–æ–∑–¥–∞–Ω–∏–µ sale_items
   ‚Üì
6. –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ payment (–µ—Å–ª–∏ paid > 0)
   ‚Üì
7. OverpaymentService::create() (–µ—Å–ª–∏ paid > total)
   ‚Üì
8. Commit —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```

### **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞:**

```
1. PaymentService::createPayment()
   ‚Üì
2. –°–æ–∑–¥–∞–Ω–∏–µ payment
   ‚Üì
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ sale (paid, debt, new_overpayment)
   ‚Üì
4. OverpaymentService::create() (–µ—Å–ª–∏ –ø–æ—è–≤–∏–ª–∞—Å—å –ø–µ—Ä–µ–ø–ª–∞—Ç–∞)
   ‚Üì
5. Commit —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```

### **–£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏:**

```
1. SalesService::deleteSale()
   ‚Üì
2. StockService::increaseStock() –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
   ‚Üì
3. OverpaymentService::adjust() (–æ—Ç–∫–∞—Ç –ø–µ—Ä–µ–ø–ª–∞—Ç—ã)
   ‚Üì
4. Soft delete –ø–ª–∞—Ç–µ–∂–µ–π
   ‚Üì
5. Soft delete –ø—Ä–æ–¥–∞–∂–∏
   ‚Üì
6. Commit —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```

### **–£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞:**

```
1. PaymentService::deletePayment()
   ‚Üì
2. –ü–µ—Ä–µ—Å—á—ë—Ç paid/debt –≤ sale
   ‚Üì
3. OverpaymentService::adjust() (–æ—Ç–∫–∞—Ç –ø–µ—Ä–µ–ø–ª–∞—Ç—ã, –µ—Å–ª–∏ –±—ã–ª–∞)
   ‚Üì
4. Soft delete payment
   ‚Üì
5. Commit —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
```

---

## üìä **–¢–ò–ü–´ –ü–ï–†–ï–ü–õ–ê–¢ –í v3.1**

| –¢–∏–ø | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | Amount |
|-----|-------------------|--------|
| `created` | –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–µ–ø–ª–∞—Ç—ã | –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ |
| `withdrawn` | –í—ã–¥–∞—á–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏ | –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ |
| `adjusted` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ / –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ | **–ú–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º** |

### **–ü—Ä–∏–º–µ—Ä—ã –≤ –ë–î:**

```sql
-- –°–æ–∑–¥–∞–Ω–∞ –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ 90 —Å–æ–º
INSERT INTO client_overpayments 
(client_id, sale_id, amount, type, balance_after)
VALUES (1, 1, 90.00, 'created', 90.00);

-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ 50 —Å–æ–º
INSERT INTO client_overpayments 
(client_id, sale_id, amount, type, balance_after)
VALUES (1, 2, -50.00, 'adjusted', 40.00);

-- –í—ã–¥–∞–Ω–æ –Ω–∞–ª–∏—á–Ω—ã–º–∏ 20 —Å–æ–º
INSERT INTO client_overpayments 
(client_id, amount, type, balance_after)
VALUES (1, 20.00, 'withdrawn', 20.00);
```

---

## ‚úÖ **–ß–ï–ö–õ–ò–°–¢ –í–ù–ï–î–†–ï–ù–ò–Ø**

### **1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
- [ ] –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã InnoDB
- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω `1_XAN_NEW_3.1.sql`
- [ ] –ù–µ—Ç —Ç–∏–ø–∞ `'used'` –≤ ENUM

### **2. PHP –°–µ—Ä–≤–∏—Å—ã**
- [ ] `OverpaymentService.php` –∏—Å–ø—Ä–∞–≤–ª–µ–Ω (–±–µ–∑ 'used')
- [ ] `PaymentService.php` —Å–æ–∑–¥–∞–Ω
- [ ] `SalesService.php` —É–ø—Ä–æ—â—ë–Ω (—É–±—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π)
- [ ] `StockService.php` –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### **3. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã**
- [ ] `sales.php` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `SalesService`
- [ ] `payments.php` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `PaymentService`
- [ ] –£–±—Ä–∞–Ω—ã –ø—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã –∏–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤

### **4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏ —Å –ø–µ—Ä–µ–ø–ª–∞—Ç–æ–π ‚Üí –±–∞–ª–∞–Ω—Å —É–≤–µ–ª–∏—á–∏–ª—Å—è
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ ‚Üí –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ ‚Üí –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- [ ] –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏ ‚Üí —Ç–æ–≤–∞—Ä—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å, –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ –æ—Ç–∫–∞—Ç–∏–ª–∞—Å—å

---

## üêõ **–¢–ï–°–¢–û–í–´–ï –°–¶–ï–ù–ê–†–ò–ò**

### **–¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏ —Å –ø–µ—Ä–µ–ø–ª–∞—Ç–æ–π**

```bash
curl -X POST 'https://obmensuzak.com.kg/han/api/sales.php?action=create' \
  -H 'Content-Type: application/json' \
  -d '{
    "client_id": 1,
    "items": [{"product_id": 1, "quantity": 10, "price": 191}],
    "paid": 2000
  }'
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
SELECT current_overpayment FROM clients WHERE id = 1;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 90.00

SELECT * FROM client_overpayments WHERE client_id = 1 ORDER BY id DESC LIMIT 1;
-- type = 'created', amount = 90.00
```

### **–¢–µ—Å—Ç 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞**

```bash
curl -X POST 'https://obmensuzak.com.kg/han/api/payments.php?action=create' \
  -H 'Content-Type: application/json' \
  -d '{
    "sale_id": 2,
    "amount": 1000,
    "payment_method": "cash"
  }'
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
-- –ï—Å–ª–∏ total = 900, –ø–æ—è–≤–∏–ª–∞—Å—å –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ 100
SELECT current_overpayment FROM clients WHERE id = 1;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 190.00 (90 + 100)
```

### **–¢–µ—Å—Ç 3: –£–¥–∞–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞**

```bash
curl -X DELETE 'https://obmensuzak.com.kg/han/api/payments.php?action=delete&id=1'
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
SELECT current_overpayment FROM clients WHERE id = 1;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 90.00 (–ø–µ—Ä–µ–ø–ª–∞—Ç–∞ –æ—Ç–∫–∞—Ç–∏–ª–∞—Å—å)

SELECT * FROM client_overpayments WHERE client_id = 1 ORDER BY id DESC LIMIT 1;
-- type = 'adjusted', amount < 0
```

---

## üìù **–°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò**

1. –°–æ–∑–¥–∞—Ç—å **ClientService.php**
2. –°–æ–∑–¥–∞—Ç—å **ProductService.php**
3. –°–æ–∑–¥–∞—Ç—å **ReceiptService.php** (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–º–µ—Ä–æ–≤ —á–µ–∫–æ–≤)
4. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `clients.php` –ø–æ–¥ —Å–µ—Ä–≤–∏—Å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
5. –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å `products.php` –ø–æ–¥ —Å–µ—Ä–≤–∏—Å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
6. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã (PHPUnit)

---

üéØ **–¢–µ–ø–µ—Ä—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —á–∏—Å—Ç–∞—è, –ø–æ–Ω—è—Ç–Ω–∞—è –∏ –±–µ–∑ —Ü–∏–∫–ª–æ–≤!**

# üèóÔ∏è **–§–ò–ù–ê–õ–¨–ù–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê HAN CRM v3.1**

## üìä **–î–ò–ê–ì–†–ê–ú–ú–ê –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         –ö–û–ù–¢–†–û–õ–õ–ï–†–´                              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  auth.php  ‚îÇ  sales.php  ‚îÇ  payments.php  ‚îÇ  clients.php  ‚îÇ     ‚îÇ
‚îÇ            ‚îÇ             ‚îÇ                ‚îÇ               ‚îÇ     ‚îÇ
‚îÇ  products.php  ‚îÇ  production.php  ‚îÇ  reports.php         ‚îÇ     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                          –°–ï–†–í–ò–°–´                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ  ‚îÇ  SalesService    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí‚îÇ  ReceiptService  ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ                  ‚îÇ        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îÇ  ‚îÇ  - createSale()  ‚îÇ                                           ‚îÇ
‚îÇ  ‚îÇ  - deleteSale()  ‚îÇ                                           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                           ‚îÇ
‚îÇ          ‚îÇ                                                       ‚îÇ
‚îÇ          ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                      ‚îÇ
‚îÇ          ‚Üì               ‚Üì                                      ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ
‚îÇ  ‚îÇ  StockService    ‚îÇ ‚îÇ OverpaymentSvc   ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ                  ‚îÇ ‚îÇ                   ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ  - increaseStock ‚îÇ ‚îÇ  - create()      ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ  - decreaseStock ‚îÇ ‚îÇ  - use()         ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ  - adjustStock   ‚îÇ ‚îÇ  - withdraw()    ‚îÇ                    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ  - adjust()      ‚îÇ                    ‚îÇ
‚îÇ                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ
‚îÇ                                ‚Üë                                ‚îÇ
‚îÇ                                ‚îÇ                                ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ                               ‚îÇ
‚îÇ  ‚îÇ  PaymentService  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                               ‚îÇ
‚îÇ  ‚îÇ                  ‚îÇ                                           ‚îÇ
‚îÇ  ‚îÇ  - createPayment ‚îÇ                                           ‚îÇ
‚îÇ  ‚îÇ  - deletePayment ‚îÇ                                           ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                           ‚îÇ
‚îÇ                                                                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê              ‚îÇ
‚îÇ  ‚îÇ  ClientService   ‚îÇ        ‚îÇ  ProductService  ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ                  ‚îÇ        ‚îÇ                   ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ  - getClients()  ‚îÇ        ‚îÇ  - getProducts() ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ  - createClient()‚îÇ        ‚îÇ  - addProduction ‚îÇ              ‚îÇ
‚îÇ  ‚îÇ  - getDebtors()  ‚îÇ        ‚îÇ  - writeOff()    ‚îÇ              ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –ë–ê–ó–û–í–´–ï –ö–õ–ê–°–°–´                                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Database  ‚îÇ  Auth  ‚îÇ  Response  ‚îÇ  Middleware                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      –ë–ê–ó–ê –î–ê–ù–ù–´–•                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  clients  ‚îÇ  products  ‚îÇ  sales  ‚îÇ  payments  ‚îÇ  stock  ‚îÇ       ‚îÇ
‚îÇ  client_overpayments  ‚îÇ  stock_movements  ‚îÇ  production  ‚îÇ      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìÅ **–ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê**

```
obmensuzak.com.kg/
‚îÇ
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ config.php                     ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ autoload.php                   ‚úÖ –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∞—Å—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ .htaccess                      ‚úÖ Apache –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ classes/                       # PHP –ö–õ–ê–°–°–´
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Database.php               ‚úÖ –ë–î (Singleton)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Auth.php                   ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (—Å–µ—Å—Å–∏–∏)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Response.php               ‚úÖ –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Middleware.php             ‚úÖ –ü—Ä–∞–≤–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ OverpaymentService.php     ‚úÖ –ü–µ—Ä–µ–ø–ª–∞—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PaymentService.php         ‚úÖ –ü–ª–∞—Ç–µ–∂–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SalesService.php           ‚úÖ –ü—Ä–æ–¥–∞–∂–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ StockService.php           ‚úÖ –°–∫–ª–∞–¥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ClientService.php          ‚úÖ –ö–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductService.php         ‚úÖ –¢–æ–≤–∞—Ä—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ReceiptService.php         ‚úÖ –ù–æ–º–µ—Ä–∞ —á–µ–∫–æ–≤
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ auth.php                       ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ sales.php                      ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø—Ä–æ–¥–∞–∂
‚îÇ   ‚îú‚îÄ‚îÄ payments.php                   ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø–ª–∞—Ç–µ–∂–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ clients.php                    ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∫–ª–∏–µ–Ω—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ products.php                   ‚ö†Ô∏è –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å
‚îÇ   ‚îú‚îÄ‚îÄ production.php                 ‚ö†Ô∏è –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å
‚îÇ   ‚îî‚îÄ‚îÄ reports.php                    ‚ö†Ô∏è –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å
‚îÇ
‚îî‚îÄ‚îÄ assets/
    ‚îú‚îÄ‚îÄ css/
    ‚îÇ   ‚îî‚îÄ‚îÄ style.css
    ‚îÇ
    ‚îú‚îÄ‚îÄ js/
    ‚îÇ   ‚îú‚îÄ‚îÄ app.js                     ‚úÖ –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ‚îÄ config/
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.config.js          ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ API
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ‚îÄ services/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.service.js         ‚úÖ –ë–∞–∑–æ–≤—ã–π API
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sales.service.js       ‚úÖ –ü—Ä–æ–¥–∞–∂–∏
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payments.service.js    ‚ö†Ô∏è –°–æ–∑–¥–∞—Ç—å
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ clients.service.js     ‚ö†Ô∏è –°–æ–∑–¥–∞—Ç—å
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îú‚îÄ‚îÄ components/
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Toast.js               ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Modal.js               ‚ö†Ô∏è –°–æ–∑–¥–∞—Ç—å
    ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Loader.js              ‚ö†Ô∏è –°–æ–∑–¥–∞—Ç—å
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚îî‚îÄ‚îÄ utils/
    ‚îÇ       ‚îú‚îÄ‚îÄ format.js              ‚ö†Ô∏è –°–æ–∑–¥–∞—Ç—å
    ‚îÇ       ‚îî‚îÄ‚îÄ validation.js          ‚ö†Ô∏è –°–æ–∑–¥–∞—Ç—å
    ‚îÇ
    ‚îî‚îÄ‚îÄ index.html                     ‚úÖ –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
```

---

## üîÑ **–ü–û–¢–û–ö–ò –î–ê–ù–ù–´–•**

### **1. –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏:**

```
Frontend (app.js)
    ‚Üì
SalesService.createSale()
    ‚Üì
API: POST /sales.php?action=create
    ‚Üì
SalesController::create()
    ‚Üì
SalesService::createSale()
    ‚îú‚îÄ‚îÄ‚Üí ReceiptService::generateReceiptNumber()
    ‚îú‚îÄ‚îÄ‚Üí StockService::decreaseStock() (–¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞)
    ‚îú‚îÄ‚îÄ‚Üí INSERT INTO sales
    ‚îú‚îÄ‚îÄ‚Üí INSERT INTO sale_items
    ‚îú‚îÄ‚îÄ‚Üí INSERT INTO payments (–ø–µ—Ä–≤–∏—á–Ω—ã–π)
    ‚îî‚îÄ‚îÄ‚Üí OverpaymentService::create() (–µ—Å–ª–∏ –ø–µ—Ä–µ–ø–ª–∞—Ç–∞)
    ‚Üì
Response: { sale_id, receipt_number, ... }
```

### **2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞:**

```
Frontend
    ‚Üì
API: POST /payments.php?action=create
    ‚Üì
PaymentsController::create()
    ‚Üì
PaymentService::createPayment()
    ‚îú‚îÄ‚îÄ‚Üí INSERT INTO payments
    ‚îú‚îÄ‚îÄ‚Üí UPDATE sales (paid, debt, new_overpayment)
    ‚îî‚îÄ‚îÄ‚Üí OverpaymentService::create() (–µ—Å–ª–∏ –ø–µ—Ä–µ–ø–ª–∞—Ç–∞)
    ‚Üì
Response: { payment_id, new_paid, new_debt }
```

### **3. –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–∂–∏:**

```
Frontend
    ‚Üì
API: DELETE /sales.php?action=delete&id=1
    ‚Üì
SalesController::delete()
    ‚Üì
SalesService::deleteSale()
    ‚îú‚îÄ‚îÄ‚Üí StockService::increaseStock() (–≤–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–æ–≤)
    ‚îú‚îÄ‚îÄ‚Üí OverpaymentService::adjust() (–æ—Ç–∫–∞—Ç –ø–µ—Ä–µ–ø–ª–∞—Ç—ã)
    ‚îú‚îÄ‚îÄ‚Üí UPDATE payments SET deleted_at (soft delete)
    ‚îî‚îÄ‚îÄ‚Üí UPDATE sales SET deleted_at (soft delete)
    ‚Üì
Response: { message: "–ü—Ä–æ–¥–∞–∂–∞ —É–¥–∞–ª–µ–Ω–∞" }
```

---

## ‚úÖ **–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ù–û–í–û–ô –ê–†–•–ò–¢–ï–ö–¢–£–†–´**

### **1. –ß–∏—Å—Ç–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**
- –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–≤–æ—é –æ–±–ª–∞—Å—Ç—å
- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã —Ç–æ–ª—å–∫–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É—é—Ç –∑–∞–ø—Ä–æ—Å—ã
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

### **2. –ù–µ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
```
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û:
SalesService ‚Üí ReceiptService
SalesService ‚Üí StockService
SalesService ‚Üí OverpaymentService
PaymentService ‚Üí OverpaymentService

‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–±—ã–ª–æ —Ä–∞–Ω—å—à–µ):
SalesService ‚áÑ OverpaymentService
```

### **3. –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∏—Å—Ç–∏–Ω—ã**
- –ë–∞–ª–∞–Ω—Å –∫–ª–∏–µ–Ω—Ç–∞ = SUM(client_overpayments.amount)
- –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç
- –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

### **4. –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**
- –í—Å–µ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ
- –î–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã

### **5. –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å**
```php
// –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä–µ–ø–ª–∞—Ç—ã
$service = new OverpaymentService();
$result = $service->create(1, 100, 1, 1);
assertEqual($result['balance_after'], 100);
```

### **6. –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å**
```php
// –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø –ø–µ—Ä–µ–ø–ª–∞—Ç—ã - –ø—Ä–æ—Å—Ç–æ:
$service->createBonus($clientId, $amount);

// –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã - –ø—Ä–æ—Å—Ç–æ:
$paymentService->createCrypto($saleId, $amount);
```

---

## üß™ **–¢–ï–°–¢–û–í–´–ï –°–¶–ï–ù–ê–†–ò–ò**

### **–¢–µ—Å—Ç 1: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ–¥–∞–∂–∏**

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥–∞–∂—É —Å –ø–µ—Ä–µ–ø–ª–∞—Ç–æ–π
curl -X POST 'https://obmensuzak.com.kg/han/api/sales.php?action=create' \
  -H 'Content-Type: application/json' \
  -d '{
    "client_id": 1,
    "items": [{"product_id": 1, "quantity": 10, "price": 191}],
    "paid": 2000
  }'

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# - –ß–µ–∫ —Å–æ–∑–¥–∞–Ω: 000001
# - –¢–æ–≤–∞—Ä —Å–ø–∏—Å–∞–Ω: stock[1] -= 10
# - –ü–µ—Ä–µ–ø–ª–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞: 90 —Å–æ–º

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å –∫–ª–∏–µ–Ω—Ç–∞
curl 'https://obmensuzak.com.kg/han/api/clients.php?action=show&id=1'

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# current_overpayment = 90.00

# 3. –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É
curl -X DELETE 'https://obmensuzak.com.kg/han/api/sales.php?action=delete&id=1'

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# - –¢–æ–≤–∞—Ä –≤–µ—Ä–Ω—É–ª—Å—è: stock[1] += 10
# - –ü–µ—Ä–µ–ø–ª–∞—Ç–∞ –æ—Ç–∫–∞—Ç–∏–ª–∞—Å—å: current_overpayment = 0.00
```

### **–¢–µ—Å—Ç 2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞**

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–¥–∞–∂—É —Å –¥–æ–ª–≥–æ–º
curl -X POST 'https://obmensuzak.com.kg/han/api/sales.php?action=create' \
  -d '{"client_id":1, "items":[{"product_id":1,"quantity":10,"price":191}], "paid":1000}'

# –†–µ–∑—É–ª—å—Ç–∞—Ç: debt = 910

# 2. –î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç—ë–∂
curl -X POST 'https://obmensuzak.com.kg/han/api/payments.php?action=create' \
  -d '{"sale_id":1, "amount":1000, "payment_method":"cash"}'

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# - new_paid = 2000
# - new_debt = 0
# - new_overpayment = 90
# - client.current_overpayment = 90
```

---

## üìù **–ß–¢–û –û–°–¢–ê–õ–û–°–¨ –°–î–ï–õ–ê–¢–¨**

### **Backend:**
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `products.php` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ProductService)
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `production.php` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ProductService)
- [ ] –°–æ–∑–¥–∞—Ç—å `reports.php` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã)

### **Frontend:**
- [ ] –°–æ–∑–¥–∞—Ç—å `payments.service.js`
- [ ] –°–æ–∑–¥–∞—Ç—å `clients.service.js`
- [ ] –°–æ–∑–¥–∞—Ç—å `Modal.js`
- [ ] –°–æ–∑–¥–∞—Ç—å `Loader.js`
- [ ] –°–æ–∑–¥–∞—Ç—å `format.js` –∏ `validation.js`

---

üéØ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ–ø–µ—Ä—å –∏–¥–µ–∞–ª—å–Ω–∞! –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã, –Ω–µ—Ç —Ü–∏–∫–ª–æ–≤, –ª–æ–≥–∏–∫–∞ –ø–æ–Ω—è—Ç–Ω–∞!**